{% extends 'base.html' %}

{% block title %}
セット商品一覧 - 在庫管理システム
{% endblock %}

{% block styles %}
<style>
    .sortable a {
        color: inherit; /* 親要素の色を継承 */
        text-decoration: none;
    }
    .sortable a:hover {
        text-decoration: underline;
    }
    .sortable .sort-icon {
        margin-left: 5px;
        color: #007bff; /* Bootstrap primary color */
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2 class="mb-4">セット商品一覧</h2>
    {% if search_query %}
    <p class="text-muted">
        検索件数: <strong>{{ total_count }}</strong> 件
    </p>
    {% else %}
    <p class="text-muted">
        全 <strong>{{ total_count }}</strong> 件
    </p>
    {% endif %}

    <div class="mb-3">
        <form class="d-flex" method="GET" action="{{ url_for('setgoods_list_page') }}">
            <input type="hidden" name="sort_by" value="{{ sort_by }}">
            <input type="hidden" name="order" value="{{ order }}">
            <input class="form-control me-2" type="search" placeholder="商品IDまたは商品名で検索" aria-label="Search" name="search" value="{{ search_query if search_query }}">
            <button class="btn btn-outline-success" type="submit">検索</button>
        </form>
    </div>

    <div class="card shadow-sm">
        <div class="card-body">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th class="sortable">
                            <a href="{{ url_for('setgoods_list_page', search=search_query, sort_by='goodsid', order='desc' if sort_by == 'goodsid' and order == 'asc' else 'asc') }}">
                                商品ID
                                {% if sort_by == 'goodsid' %}
                                    <i class="bi {{ 'bi-arrow-up' if order == 'asc' else 'bi-arrow-down' }} sort-icon"></i>
                                {% endif %}
                            </a>
                        </th>
                        <th class="sortable">
                            <a href="{{ url_for('setgoods_list_page', search=search_query, sort_by='goodsnm', order='desc' if sort_by == 'goodsnm' and order == 'asc' else 'asc') }}">
                                商品名
                                {% if sort_by == 'goodsnm' %}
                                    <i class="bi {{ 'bi-arrow-up' if order == 'asc' else 'bi-arrow-down' }} sort-icon"></i>
                                {% endif %}
                            </a>
                        </th>
                        <th class="sortable">
                            <a href="{{ url_for('setgoods_list_page', search=search_query, sort_by='price', order='desc' if sort_by == 'price' and order == 'asc' else 'asc') }}">
                                価格
                                {% if sort_by == 'price' %}
                                    <i class="bi {{ 'bi-arrow-up' if order == 'asc' else 'bi-arrow-down' }} sort-icon"></i>
                                {% endif %}
                            </a>
                        </th>
                        <th>使用フラグ</th>
                        <th class="sortable">
                            <a href="{{ url_for('setgoods_list_page', search=search_query, sort_by='fentdt', order='desc' if sort_by == 'fentdt' and order == 'asc' else 'asc') }}">
                                登録日時
                                {% if sort_by == 'fentdt' %}
                                    <i class="bi {{ 'bi-arrow-up' if order == 'asc' else 'bi-arrow-down' }} sort-icon"></i>
                                {% endif %}
                            </a>
                        </th>
                        <th class="sortable">
                            <a href="{{ url_for('setgoods_list_page', search=search_query, sort_by='fupdtedt', order='desc' if sort_by == 'fupdtedt' and order == 'asc' else 'asc') }}">
                                更新日時
                                {% if sort_by == 'fupdtedt' %}
                                    <i class="bi {{ 'bi-arrow-up' if order == 'asc' else 'bi-arrow-down' }} sort-icon"></i>
                                {% endif %}
                            </a>
                        </th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody>
                    {% for set_good in set_goods %}
                    <tr>
                        <td>{{ set_good.goodsid }}</td>
                        <td>{{ set_good.goodsnm }}</td>
                        <td>{{ set_good.price }}</td>
                        <td>{{ '未使用' if set_good.useflg != None else '使用中' }}</td>
                        <td>{{ set_good.fentdt }}</td>
                        <td>{{ set_good.fupdtedt }}</td>
                        <td>
                            <a href="{{ url_for('edit_setgood_page', setgood_id=set_good.goodsid) }}" class="btn btn-success btn-sm">編集</a>
                            <button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal-{{ set_good.goodsid }}">
                                削除
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
        <!-- モーダルはここでまとめて -->
                {% for set_good in set_goods %}
                    <div class="modal fade" id="deleteModal-{{ set_good.goodsid }}" tabindex="-1" aria-labelledby="deleteModalLabel-{{ set_good.goodsid }}" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="deleteModalLabel-{{ set_good.goodsid }}">セット商品の削除</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    本当に「{{ set_good.goodsnm }}」を削除しますか？この操作は元に戻せません。
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">キャンセル</button>
                                    <form action="{{ url_for('delete_setgood', setgood_id=set_good.goodsid) }}" method="POST" style="display: inline;">
                                        <input type="hidden" name="setgood_id" value="{{ set_good.goodsid }}">
                                        <button type="submit" class="btn btn-danger">削除実行</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
</div>
{% endblock %}