# 在庫管理システム(ポートフォリオ版)

実家の輸入販売業（自営業）の業務効率化のために開発し、実運用されている在庫・販売管理システムのポートフォリオ版です。
本番環境ではOracle Databaseを使用していますが、ポートフォリオ用にSQLiteで動作するように構成を変更しています。

## デモ動画(54秒) 

いくつかの機能の操作を行ったデモ動画です。ファイルサイズの関係上、再生速度を調整しています。

[デモ動画を再生する](https://github.com/user-attachments/assets/ff419dd6-7fdd-405a-aad5-048e803834aa)

## 概要

このアプリケーションは、商品の在庫管理、販売記録、顧客情報、注文管理などを行うことができるWebアプリケーションです。

## 開発背景と解決した課題

### 課題
既存の業務フローでは、商品納品のたびに**目視による在庫カウント**を行っており、管理コストとヒューマンエラーが常態化していました。また、入荷日や納品日のスケジュール管理は**担当者間の口頭連絡や個人の記憶**に依存しており、情報の属人化が課題となっていました。

### 導入効果
本システム導入により、業務フローをデジタル化し、以下の課題を解決しました。

- **在庫管理の自動化:**
    販売データと連動して在庫数が自動減算されるロジックを実装し、人力によるカウント作業と計算ミスを排除しました。
- **ステータス管理の脱属人化:**
    「入荷」「納品」といった商品の状態遷移をシステム上で管理。誰に聞かなくても、画面を見れば正確な日付と状態が把握できるようになりました。
- **情報の集中管理（Web化）:**
    Excelやメモ書き、口頭での管理を廃止し、Webブラウザ上で一元管理。ネットワーク内であれば「誰でも・いつでも・簡単に」正確な商品情報を確認できる環境を構築しました。

## 技術スタック

- **バックエンド**: Flask 3.1.0
- **データベース**: SQLite (ポートフォリオ版) / Oracle Database (本番環境用)
- **ORM**: SQLAlchemy 2.0
- **フォーム処理**: WTForms
- **キャッシュ**: Flask-Caching

## こだわった実装ポイント

### 1. 複雑な在庫連動と属性処理ロジック
- **セット商品（親子関係）の在庫連動:**
  単品だけでなくセット商品（Parent）の概念を導入。セット商品が購入された際、親商品の在庫は持たせず、**構成する子商品（Child）の在庫のみを自動的に特定・減算するロジック**を実装しました。
- **柔軟な属性（カラー・サイズ）割り当て:**
  実運用の現場で発生する「入力漏れ」や「不規則な注文」に対応するため、独自の割り当てアルゴリズムを実装しました。
  - **既定値フラグの判定:** カラー指定がない場合、単なる入力ミスなのか、商品マスタ側で「固定カラー」を持っているのかをFlag判定し、処理を分岐させています。
  - **在庫減算のカラー処理:** 例えば「商品3点購入に対してカラー指定が2点のみ」といった販売があった際、システムエラーにするのではなく、「指定分を優先減算し、残りを先頭カラーから減算する」という救済ロジックを組み込み、**販売機会の損失と在庫ズレを最小限に抑えています。**

### 2. 状態遷移のバッチ処理（一括操作）
- **一括ステータス更新:**
  「入荷待ち→在庫」「在庫→納品済み」といったステータス変更を、1件ずつではなくリストから一括で更新できる機能を実装。大量納品時の管理工数を大幅に削減しました。

### 3. 堅牢なデータベース設計
- **参照整合性の担保:**
  セット商品の構成テーブルなどで、商品IDに対して**外部キー制約**を設定。データの不整合を防ぎ、信頼性を保証しています。

### 4. 例外データへのフェイルセーフ（エラーハンドリング）
- **未登録商品の検知とリカバリー:**
  販売データ内にシステム未登録の商品コードが含まれていた場合、処理を中断させるのではなく、「未登録商品リスト」として一時的に隔離・表示する機能を実装しました。
  これにより、現場の業務を止めずに、後からスムーズにマスタ登録を行える業務を確立しました。

## 主な機能

- **在庫・商品管理**
    - 商品マスタ登録 / 編集
    - セット商品定義（親商品と子商品の紐付け）
    - 販売後の在庫数更新
- **販売・顧客管理**
    - 販売マスタ編集
- **出荷・納品管理**
    - 商品の出荷状態登録/編集
    - 商品の納品状態登録/編集
- **システム管理**
    - データの検索・フィルタリング
    - マスターデータ管理（配送方法、口座情報など）

## プロジェクト構造

```
SMAPI_Portfolio/
├── app.py              # アプリケーションのエントリーポイント
├── __init__.py         # Flaskアプリケーションの初期化
├── config.py           # 設定ファイル（環境別設定）
├── models.py           # データベースモデル定義
├── routes.py           # ルーティング定義
├── forms.py            # フォーム定義（WTForms）
├── utils.py            # ユーティリティ関数
├── seed.py             # ダミーデータ投入スクリプト
├── requirements.txt    # 依存パッケージリスト
├── .env.example        # 環境変数のテンプレート
├── .gitignore          # Git除外ファイル設定
├── templates/          # HTMLテンプレート
└── static/            # 静的ファイル（CSS、画像など）
```

## データベース構成

### 主要テーブル

- **商品 (Goods)**: 商品マスタ情報
- **入荷情報 (Arrival)**: 商品の入荷履歴
- **販売記録 (SalesRecord)**: 販売トランザクション
- **顧客情報 (CustomerInfo)**: 顧客マスタ
- **COLOR**: カラーマスタ
- **注文商品 (OrderGoods)**: 発注情報
- **セット商品 (SetGoods)**: セット商品情報
- **振込み先 (BankAccount)**: 銀行口座情報
- **郵送方法 (Freight)**: 配送方法マスタ


## セットアップ手順

### 1. リポジトリのクローン

```bash
git clone <repository-url>
cd SMAPI_Portfolio
```

### 2. 仮想環境の作成と有効化

**Windows:**
```bash
python -m venv .venv
.venv\Scripts\activate
```

**macOS/Linux:**
```bash
python3 -m venv .venv
source .venv/bin/activate
```

### 3. 依存パッケージのインストール

```bash
pip install -r requirements.txt
```

### 4. 環境変数の設定

`.env.example`をコピーして`.env`ファイルを作成します:

```bash
# Windows
copy .env.example .env

# macOS/Linux
cp .env.example .env
```

`.env`ファイルの内容（デフォルトはSQLiteを使用）:
```
SECRET_KEY=your-secret-key-here
DATABASE_URL=sqlite:///local_market.db
CACHE_TYPE=SimpleCache
FLASK_ENV=development
FLASK_DEBUG=True
```

### 5. データベースの初期化とダミーデータの投入

```bash
python seed.py
```

このコマンドで以下が実行されます:
- データベーステーブルの作成
- サンプルデータの投入（商品、顧客、販売記録など）

### 6. アプリケーションの起動

```bash
python app.py
```

ブラウザで `http://localhost:5000` にアクセスしてください。

### 注意事項
 - この在庫管理システムは、ポートフォリオ版のため実際のデータベースを利用していません。ローカルデータベースを利用して、動作します。ご了承ください。
 - ネットワーク内での実装想定です。

## 環境設定

### ポートフォリオ版（デフォルト）

```python
# デフォルトでSQLiteを使用
DATABASE_URL=sqlite:///local_market.db
```

### 本番環境（Oracle Database）

```python
# Oracle Databaseを使用する場合
DATABASE_URL=oracle+cx_oracle://username:password@host:port/?service_name=service_name
```

環境変数 `FLASK_CONFIG` で設定を切り替えることもできます:
- `portfolio`: ポートフォリオ用（SQLite、デフォルト）
- `development`: 開発環境用
- `production`: 本番環境用

```bash
# 本番環境として起動する場合
export FLASK_CONFIG=production  # macOS/Linux
set FLASK_CONFIG=production     # Windows
```

## 注意事項

### セキュリティ

- `.env`ファイルは**絶対にGitにコミットしないでください**
- 本番環境では必ず強力な`SECRET_KEY`を設定してください
- ポートフォリオ版のダミーデータは公開しても問題ない内容にしてあります

### データベースファイル

- SQLiteのデータベースファイル(`local_market.db`)もGitリポジトリに含めないようにしてください
- `.gitignore`に設定済みです

## トラブルシューティング

### データベース接続エラー

SQLiteを使用している場合、データベースファイルが存在しない場合は自動的に作成されます。`seed.py`を実行してテーブルとデータを初期化してください。

### 依存パッケージのエラー

特定のパッケージでエラーが発生する場合:
```bash
pip install --upgrade pip
pip install -r requirements.txt --upgrade
```

### Oracle Database接続（本番環境のみ）

Oracle Databaseを使用する場合は、Oracle Instant Clientのインストールが必要です:
- [Oracle Instant Clientダウンロード](https://www.oracle.com/database/technologies/instant-client/downloads.html)

## ライセンス

このプロジェクトはポートフォリオ用のサンプルアプリケーションです。

## 作成者

bkeba01

## 更新履歴

- 2024-12: ポートフォリオ版を作成
  - SQLite対応
  - 環境変数による設定管理
  - ダミーデータ生成機能

---

**Note**: このアプリケーションはポートフォリオ・デモ用です。本番環境で使用する場合は、適切なセキュリティ対策とテストを実施してください。
